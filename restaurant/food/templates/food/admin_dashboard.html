{% extends 'food/base.html' %}
{% block content %}

<div class="container py-5 ">

  <!-- ===== DASHBOARD HEADER ===== -->
  <div class="text-center mb-5 mt-5">
    <h1 class="fw-bold text-success mt-5"><i class="bi bi-speedometer2 me-2"></i>Admin Dashboard</h1>
    <p class="text-muted fs-5">Manage all users, orders, messages & gallery images from one place</p>
    <hr class="w-25 mx-auto border-success opacity-75">
  </div>

  <!-- ===== DASHBOARD SUMMARY ===== -->
  <div class="row text-center mb-5 g-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-3 bg-success text-white rounded-4">
        <h6>Total Users</h6>
        <h3>{{ total_users }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-3 bg-warning text-white rounded-4">
        <h6>Total Food Orders</h6>
        <h3>{{ total_food_orders }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-3 bg-info text-white rounded-4">
        <h6>Total Gallery Orders</h6>
        <h3>{{ total_gallery_orders }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-3 bg-danger text-white rounded-4">
        <h6>Total Revenue</h6>
        <h3>₹{{ total_revenue }}</h3>
      </div>
    </div>
  </div>

  <!-- ===== TABLE SECTION ===== -->
  {% comment %} Single Section for all tables with proper headings {% endcomment %}
  <div class="dashboard-tables">

    <!-- Food Items -->
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-success"><i class="bi bi-ui-checks-grid me-2"></i>Food Items</h3>
        <a href="{% url 'food:add_food' %}" class="btn btn-success btn-sm">+ Add Food</a>
      </div>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-success">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Description</th>
              <th>Price</th>
              <th>Image</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in food_items %}
            <tr>
              <td>{{ item.id }}</td>
              <td>{{ item.name }}</td>
              <td>{{ item.description|truncatechars:30 }}</td>
              <td>₹{{ item.price }}</td>
              <td>
                {% if item.image %}
                  <img src="{{ item.image.url }}" height="50" class="rounded">
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>
                <a href="{% url 'food:edit_food' item.id %}" class="btn btn-primary btn-sm">Edit</a>
                <a href="{% url 'food:delete_food' item.id %}" class="btn btn-danger btn-sm">Delete</a>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-center text-muted">No food items yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>


     <!-- Gallery Images -->
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-success"><i class="bi bi-card-image me-2"></i>Gallery Images</h3>
        <a href="{% url 'food:add_gallery' %}" class="btn btn-success btn-sm">+ Add Image</a>
      </div>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-secondary">
            <tr>
              <th>ID</th>
              <th>Image</th>
              <th>Caption</th>
              <th>Price</th>
              <th>Uploaded At</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for img in gallery_images %}
            <tr>
              <td>{{ img.id }}</td>
              <td>
                {% if img.image %}
                  <img src="{{ img.image.url }}" alt="Gallery Image" height="50" class="rounded">
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>{{ img.caption }}</td>
              <td>₹{{ img.price }}</td>
              <td>{{ img.created_at }}</td>
              <td>
                <form method="POST" action="{% url 'food:delete_gallery' img.id %}" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm"
                    onclick="return confirm('Are you sure you want to delete this image?');">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-center text-muted">No gallery images yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>



    <!-- Food Orders -->
    <div class="mb-5">
      <h3 class="text-success mb-3"><i class="bi bi-basket3 me-2"></i>Food Orders</h3>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-warning">
            <tr>
              <th>#</th>
              <th>User</th>
              <th>Item</th>
              <th>Qty</th>
              <th>Total</th>
              <th>Ordered At</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ order.user.username }}</td>
              <td>{{ order.item.name }}</td>
              <td>{{ order.quantity }}</td>
              <td>₹{{ order.total_price }}</td>
              <td>{{ order.ordered_at }}</td>
              <td>
                {% if order.status == "Completed" %}
                  <span class="badge bg-success">Completed</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
              </td>
              <td>
                {% if order.status != "Completed" %}
                  <form method="POST" action="{% url 'food:mark_done' order.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm">Mark Done</button>
                  </form>
                {% else %}
                  <span class="text-muted">Done</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="8" class="text-center text-muted">No food orders yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

<!-- 🌸 Gallery Orders Table -->
<div class="mb-5">
  <h3 class="text-success mb-3">
    <i class="bi bi-images me-2"></i>Gallery Orders
  </h3>

  <div class="table-responsive shadow-sm rounded-3">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-info">
        <tr>
          <th>#</th>
          <th>User</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Ordered At</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        {% for gorder in gallery_orders %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td class="fw-semibold">{{ gorder.user.username }}</td>
          <td title="{{ gorder.gallery_item.caption }}">
            {{ gorder.gallery_item.caption|truncatechars:20 }}
          </td>
          <td>{{ gorder.quantity }}</td>
          <td>₹{{ gorder.total_price }}</td>
          <td>{{ gorder.ordered_at|date:"M d, Y - h:i A" }}</td>

          <td>
            {% if gorder.status == "Completed" %}
              <span class="badge bg-success px-3 py-2">Completed</span>
            {% else %}
              <span class="badge bg-warning text-dark px-3 py-2">Pending</span>
            {% endif %}
          </td>

          <td>
            {% if gorder.status != "Completed" %}
              <form method="POST" 
                    action="{% url 'food:mark_gallery_done' gorder.id %}">
                {% csrf_token %}
                <button type="submit" 
                        class="btn btn-success btn-sm rounded-pill shadow-sm">
                  Mark Done
                </button>
              </form>
            {% else %}
              <span class="text-muted fst-italic">Done</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">
            <i class="bi bi-inbox"></i> No gallery orders yet.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  .table th, .table td {
    vertical-align: middle;
  }
  .badge {
    font-size: 0.85rem;
    font-weight: 600;
  }
  .btn-success {
    background-color: #16a34a;
    border: none;
  }
  .btn-success:hover {
    background-color: #15803d;
  }
</style>



    <div class="mb-5">
  <h3 class="text-success mb-3">
    <i class="bi bi-credit-card me-2"></i>Payments
  </h3>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-warning">
        <tr>
          <th>#</th>
          <th>User</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Address</th>
          <th>State</th>
          <th>Country</th>
          <th>Pin Code</th>
          <th>Method</th>
          <th>Amount (₹)</th>
          <th>Paid At</th>
        </tr>
      </thead>
      <tbody>
        {% for pay in payments %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ pay.user.username }}</td>
          <td>{{ pay.first_name }}</td>
          <td>{{ pay.last_name }}</td>
          <td>{{ pay.address|truncatechars:30 }}</td>
          <td>{{ pay.state }}</td>
          <td>{{ pay.country }}</td>
          <td>{{ pay.pin_code }}</td>

          <!-- Payment Method Badge -->
          <td>
            {% if pay.payment_method == 'credit' %}
              <span class="badge rounded-pill bg-info text-dark px-3 py-2">Credit</span>
            {% elif pay.payment_method == 'debit' %}
              <span class="badge rounded-pill bg-warning text-dark px-3 py-2">Debit</span>
            {% else %}
              <span class="badge rounded-pill bg-success px-3 py-2">UPI</span>
            {% endif %}
          </td>

          <!-- Amount with badge -->
          <td>
            <span class="badge rounded-pill bg-success px-3 py-2">
              ₹{{ pay.amount }}
            </span>
          </td>

          <td>{{ pay.created_at|date:"d M Y" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="11" class="text-center text-muted">
            No payments recorded yet.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Optional Custom Styling -->
<style>
  .table thead th {
    background-color: #fff3cd !important;
  }
  .badge {
    font-size: 0.9rem;
  }
  .table-hover tbody tr:hover {
    background-color: #fef9c3;
    transition: 0.2s;
  }
</style>



    <!-- Messages -->
    <div class="mb-5">
      <h3 class="text-success mb-3"><i class="bi bi-envelope me-2"></i>Messages</h3>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Subject</th>
              <th>Message</th>
              <th>Sent At</th>
            </tr>
          </thead>
          <tbody>
            {% for msg in messages %}
            <tr>
              <td>{{ msg.id }}</td>
              <td>{{ msg.name }}</td>
              <td>{{ msg.email }}</td>
              <td>{{ msg.subject }}</td>
              <td>{{ msg.message }}</td>
              <td>{{ msg.sent_at }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-center text-muted">No messages yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="mb-5">
  <h3 class="text-success mb-3"><i class="bi bi-star-half"></i> User Feedbacks</h3>
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-warning">
        <tr>
          <th>#</th>
          <th>User</th>
          <th>Message</th>
          <th>Rating</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for fb in feedbacks %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ fb.user.username }}</td>
          <td>{{ fb.message }}</td>
          <td>{{ fb.rating }} ⭐</td>
          <td>{{ fb.created_at|date:"d M Y" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center text-muted">No feedbacks yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>


   
  </div>

</div>
{% endblock %}
